// Prisma Schema for RetailFlow ERP

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ============================================
// AUTH & USER MANAGEMENT
// ============================================

enum Role {
  ADMIN
  MANAGER
  EMPLOYEE
}

model User {
  id           String   @id @default(cuid())
  email        String   @unique
  name         String
  passwordHash String   @map("password_hash")
  role         Role     @default(EMPLOYEE)
  active       Boolean  @default(true)
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")

  // Relations
  employee          Employee?
  inventoryEntries  InventoryEntry[]
  salesOrders       SalesOrder[]
  purchaseOrders    PurchaseOrder[]
  transactions      Transaction[]

  @@map("users")
}

// ============================================
// INVENTORY MODULE
// ============================================

model Product {
  id          String   @id @default(cuid())
  sku         String   @unique
  name        String
  description String?
  price       Decimal  @db.Decimal(10, 2)
  cost        Decimal  @db.Decimal(10, 2)
  category    String
  minStock    Int      @default(10) @map("min_stock")
  active      Boolean  @default(true)
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  // Relations
  inventoryEntries  InventoryEntry[]
  salesOrderItems   SalesOrderItem[]
  purchaseOrderItems PurchaseOrderItem[]

  @@map("products")
}

enum InventoryType {
  IN
  OUT
  ADJUSTMENT
}

model InventoryEntry {
  id        String        @id @default(cuid())
  productId String        @map("product_id")
  quantity  Int
  type      InventoryType
  reason    String?
  createdBy String?       @map("created_by")
  createdAt DateTime      @default(now()) @map("created_at")

  // Relations
  product Product @relation(fields: [productId], references: [id])
  user    User?   @relation(fields: [createdBy], references: [id])

  @@map("inventory_entries")
}

model Supplier {
  id          String   @id @default(cuid())
  name        String
  contactName String?  @map("contact_name")
  email       String?
  phone       String?
  address     String?
  active      Boolean  @default(true)
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  // Relations
  purchaseOrders PurchaseOrder[]

  @@map("suppliers")
}

// ============================================
// SALES MODULE
// ============================================

model Customer {
  id        String   @id @default(cuid())
  name      String
  email     String?
  phone     String?
  address   String?
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  // Relations
  salesOrders SalesOrder[]

  @@map("customers")
}

enum OrderStatus {
  PENDING
  CONFIRMED
  SHIPPED
  DELIVERED
  CANCELLED
}

model SalesOrder {
  id         String      @id @default(cuid())
  orderNumber String     @unique @map("order_number")
  customerId String      @map("customer_id")
  status     OrderStatus @default(PENDING)
  total      Decimal     @db.Decimal(10, 2)
  notes      String?
  orderDate  DateTime    @default(now()) @map("order_date")
  createdBy  String?     @map("created_by")
  createdAt  DateTime    @default(now()) @map("created_at")
  updatedAt  DateTime    @updatedAt @map("updated_at")

  // Relations
  customer    Customer         @relation(fields: [customerId], references: [id])
  user        User?            @relation(fields: [createdBy], references: [id])
  items       SalesOrderItem[]
  transactions Transaction[]

  @@map("sales_orders")
}

model SalesOrderItem {
  id        String  @id @default(cuid())
  orderId   String  @map("order_id")
  productId String  @map("product_id")
  quantity  Int
  unitPrice Decimal @map("unit_price") @db.Decimal(10, 2)
  subtotal  Decimal @db.Decimal(10, 2)

  // Relations
  order   SalesOrder @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product Product    @relation(fields: [productId], references: [id])

  @@map("sales_order_items")
}

// ============================================
// PROCUREMENT MODULE
// ============================================

enum PurchaseOrderStatus {
  DRAFT
  PENDING
  APPROVED
  ORDERED
  RECEIVED
  CANCELLED
}

model PurchaseOrder {
  id           String              @id @default(cuid())
  orderNumber  String              @unique @map("order_number")
  supplierId   String              @map("supplier_id")
  status       PurchaseOrderStatus @default(DRAFT)
  total        Decimal             @db.Decimal(10, 2)
  orderDate    DateTime?           @map("order_date")
  expectedDate DateTime?           @map("expected_date")
  receivedDate DateTime?           @map("received_date")
  notes        String?
  createdBy    String?             @map("created_by")
  createdAt    DateTime            @default(now()) @map("created_at")
  updatedAt    DateTime            @updatedAt @map("updated_at")

  // Relations
  supplier Supplier              @relation(fields: [supplierId], references: [id])
  user     User?                 @relation(fields: [createdBy], references: [id])
  items    PurchaseOrderItem[]

  @@map("purchase_orders")
}

model PurchaseOrderItem {
  id        String  @id @default(cuid())
  orderId   String  @map("order_id")
  productId String  @map("product_id")
  quantity  Int
  unitCost  Decimal @map("unit_cost") @db.Decimal(10, 2)
  subtotal  Decimal @db.Decimal(10, 2)

  // Relations
  order   PurchaseOrder @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product Product       @relation(fields: [productId], references: [id])

  @@map("purchase_order_items")
}

// ============================================
// HR MODULE
// ============================================

enum EmployeeStatus {
  ACTIVE
  ON_LEAVE
  TERMINATED
}

model Employee {
  id         String         @id @default(cuid())
  userId     String?        @unique @map("user_id")
  firstName  String         @map("first_name")
  lastName   String         @map("last_name")
  email      String         @unique
  phone      String?
  department String
  position   String
  hireDate   DateTime       @map("hire_date")
  salary     Decimal?       @db.Decimal(10, 2)
  status     EmployeeStatus @default(ACTIVE)
  createdAt  DateTime       @default(now()) @map("created_at")
  updatedAt  DateTime       @updatedAt @map("updated_at")

  // Relations
  user User? @relation(fields: [userId], references: [id])

  @@map("employees")
}

// ============================================
// ACCOUNTING MODULE
// ============================================

enum TransactionType {
  INCOME
  EXPENSE
}

model Transaction {
  id          String          @id @default(cuid())
  type        TransactionType
  amount      Decimal         @db.Decimal(10, 2)
  category    String
  description String?
  orderId     String?         @map("order_id")
  createdBy   String?         @map("created_by")
  date        DateTime        @default(now())
  createdAt   DateTime        @default(now()) @map("created_at")

  // Relations
  order SalesOrder? @relation(fields: [orderId], references: [id])
  user  User?       @relation(fields: [createdBy], references: [id])

  @@map("transactions")
}
